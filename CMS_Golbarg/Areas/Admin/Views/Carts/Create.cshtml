@model CMS_Golbarg.ViewModel.CreateCartViewModel

@{
    ViewBag.Title = "Create";

}


        @using (Html.BeginForm())
        {

            @Html.AntiForgeryToken()
            <div class="box box-primary">
                <div class="box-header with-border">
                    <b>خرید فرمول رنگ ترکیبی</b>
                </div>
                <div class="box-body">


                    <div class="form-horizontal">
                        
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })


                        <div class="form-group">
                            @Html.LabelFor(model => model.DestinationHairColorID, htmlAttributes: new { @class = "control-label" })
                            
                                @Html.DropDownList("DestinationHairColorID", new SelectList(ViewBag.DestinationHairColors, "Id", "InterNationalColorCode"), "رنگ موی درخواستی را انتخاب کنید", htmlAttributes: new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.DestinationHairColorID, "", new { @class = "text-danger" })
                            
                        </div>

                        <div class="form-group">
                            <div class="control-label">رنگ موی فعلی</div>
                            
                                <select class="form-control" id="ActualHairColorID" name="ActualHairColorID">
                                    <option></option>
                                </select>
                            
                        </div>

                        <div class="form-group alert alert-danger" style="display:none" id="decolor">
                            <div class="control-label">نیاز به دکلره با مقدار زیر دارد</div>
                            
                                <div class="form-control">
                                    <p id="DecolorState" readonly></p>
                                </div>
                            
                        </div>

                    </div>



                </div>




                <div class="box-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <button class="btn btn-default fa fa-save" title="ذخیره"></button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <a href="@Url.Action("index")" class="btn btn-default fa fa-backward" title="بازگشت به لیست"></a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        }
        

        

        @section Scripts {

            <script>

                $('#DestinationHairColorID').change(function () {
                    $('#ActualHairColorID').empty();
                    $('#decolor').hide();

                    $('#ActualHairColorID').append('<option value="-1">لطفا رنگ فعلی موهای خود را انتخاب کنید</option>');

                    var form = $('form');
                    var token = $('input[name="__RequestVerificationToken"]', form).val();
                    $.ajax({

                        type: "POST",

                        url: "/Carts/get_ActualHairColors",

                        datatype: "Json",

                        data: { __RequestVerificationToken: token, DestinationHairColorID: $('#DestinationHairColorID').val() },

                        success: function (data) {

                            $.each(data, function (index, value) {

                                $('#ActualHairColorID').append('<option value="' + value.Id + '">' + value.InterNationalColorCode + '</option>');

                            });

                        }


                    });


                });

                $('#ActualHairColorID').change(function () {
                    $('#decolor').hide();
                    var form = $('form');
                    var token = $('input[name="__RequestVerificationToken"]', form).val();


                    $.ajax({

                        type: "POST",

                        url: "/Carts/get_DecolorState",

                        datatype: "Json",

                        data: { __RequestVerificationToken: token, DestinationHairColorID: $('#DestinationHairColorID').val(), ActualHairColorID: $('#ActualHairColorID').val() },

                        success: function (data) {
                            if (data != null || data != "") {
                                $('#DecolorState').text(data);
                                $('#decolor').show();
                            }
                            else {
                                $('#decolor').hide();
                            }


                        }


                    });


                });

                $('form').submit(function (event) {
                    event.preventDefault();


                    var form = $('form');
                    var token = $('input[name="__RequestVerificationToken"]', form).val();


                    $.ajax({

                        type: "POST",

                        url: "/Carts/Create",

                        datatype: "Json",

                        data: { __RequestVerificationToken: token, DestinationHairColorID: $('#DestinationHairColorID').val(), ActualHairColorID: $('#ActualHairColorID').val() },

                        success: function (data) {
                            var obj = JSON.stringify(data);
                            obj = JSON.parse(obj);

                            bootbox.alert(obj.res);


                        }


                    });


                });






















            </script>
        }
